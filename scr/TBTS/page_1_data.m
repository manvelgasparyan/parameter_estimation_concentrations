global Z B x_0 H y_1 T k_0 t_1 y_2

Z_0 = [eye(22,22) zeros(22,2)];

Z_0(1,23) = 1;    Z_0(1,24) = 1;
Z_0(3,23) = 1;    Z_0(6,24) = 1;

Z = Z_0;

B_0 = zeros(24,49); 

B_0(22,1) = -1; B_0(9,2) = -1;  B_0(9,3) = -1;   B_0(15,4) = -1;  B_0(22,5) = -1;           
B_0(9,1) = 1;   B_0(22,2) = 1;  B_0(15,3) =  1;  B_0(9,4) =  1;   B_0(10,5) =  1;

B_0(10,6) = -1;  B_0(10,7) = -1;  B_0(15,8) = -1;  B_0(15,9) = -1;  B_0(20,10) = -1;           
B_0(22,6) =  1;  B_0(15,7) =  1;  B_0(10,8) =  1;  B_0(20,9) =  1;  B_0(15,10) =  1;

B_0(9,11) = -1;  B_0(17,12) = -1;  B_0(10,13) = -1;  B_0(19,14) = -1;  B_0(22,15) = -1;           
B_0(17,11) =  1;  B_0(9,12) =  1;  B_0(19,13) =  1;  B_0(10,14) =  1;  B_0(12,15) =  1;

B_0(12,16) = -1;  B_0(12,17) = -1;  B_0(17,18) = -1;  B_0(17,19) = -1;  B_0(20,20) = -1;           
B_0(22,16) =  1;  B_0(17,17) =  1;  B_0(12,18) =  1;  B_0(20,19) =  1;  B_0(17,20) =  1;

B_0(12,21) = -1;  B_0(19,22) = -1;  B_0(19,23) = -1;  B_0(20,24) = -1;  B_0(20,25) = -1;           
B_0(19,21) =  1;  B_0(12,22) =  1;  B_0(20,23) =  1;  B_0(19,24) =  1;  B_0(23,25) =  1;

B_0(3,26) = -1;  B_0(13,27) = -1;  B_0(13,28) = -1;  B_0(22,29) = -1;  B_0(3,30) = -1;           
B_0(13,26) =  1;  B_0(3,27) =  1;  B_0(22,28) =  1;  B_0(13,29) =  1;  B_0(4,30) =  1;

B_0(4,31) = -1;  B_0(3,32) = -1;  B_0(5,33) = -1;  B_0(22,34) = -1;  B_0(11,35) = -1;           
B_0(3,31) =  1;  B_0(5,32) =  1;  B_0(3,33) =  1;  B_0(11,34) =  1;  B_0(22,35) =  1;

B_0(11,36) = -1;  B_0(16,37) = -1;  B_0(16,38) = -1;  B_0(21,39) = -1;  B_0(11,40) = -1;           
B_0(16,36) =  1;  B_0(11,37) =  1;  B_0(21,38) =  1;  B_0(16,39) =  1;  B_0(18,40) =  1;

B_0(18,41) = -1;  B_0(18,42) = -1;  B_0(21,43) = -1;  B_0(9,44) = -1;   B_0(16,45) = -1;           
B_0(11,41) =  1;  B_0(21,42) =  1;  B_0(18,43) =  1;  B_0(16,44) =  1;  B_0(9,45) =  1;

B_0(10,46) = -1;  B_0(18,47) = -1;  B_0(15,48) = -1;  B_0(21,49) = -1;  B_0(21,50) = -1;           
B_0(18,46) =  1;  B_0(10,47) =  1;  B_0(21,48) =  1;  B_0(15,49) =  1;  B_0(24,50) =  1;

B_0(6,51) = -1;   B_0(14,52) = -1;  B_0(14,53) = -1;   B_0(22,54) = -1;  B_0(6,55) = -1;             
B_0(14,51) =  1;  B_0(6,52) =  1;   B_0(22,53) =  1;   B_0(14,54) = 1;  B_0(7,55) = 1;

B_0(7,56) = -1; B_0(6,57) = -1;  B_0(8,58) = -1;  B_0(1,59) = -1;                
B_0(6,56) =  1; B_0(8,57) =  1;  B_0(6,58) =  1;  B_0(2,59) =  1;   

B = B_0;

k_0 = [53.4178;  9.0680; 1.1917; 3.63; 67.87; 9.52; 7.97; 4.5;  1.76;  5.5; 
       5.0734; 5.0396; 92.9616; 69.67; 58.28; 81.54; 7.90; 8.89; 13.05; 6.54;
       6.2615; 9.5536; 2.7479; 7.95; 8.13; 2.78; 4.81; 0.09; 5.47; 4.52;
       7.8669; 8.6056; 2.6729; 6.64;  8.35; 2.60; 6.09; 5.98; 7.08; 4.23;
       6.9012; 5.1458; 9.8363; 8.01;  1.70; 2.09; 6.27; 8.43; 4.49; 0.94;
       5.2317; 2.8599;  3.2270; 6.47; 3.24;  4.95; 8.96; 1.25; 2.31];

x_0 = zeros(22,1);

x_0(1) = 2; x_0(4) = 6;  x_0(5) = 5; x_0(7) = 3; x_0(8) = 7; x_0(22) = 4;

T = 19;

mu_1 = 5;

t_span_1 = 0:T/mu_1:T;

[t_1, x_1] = Concentrations (k_0, Z, B, x_0, t_span_1);

H = [eye(8,8) zeros(8,14);
     zeros(1,21) 1];

[s,c] = size(Z);

[n,~] = size(H);

[~,r] = size(B);

y_1 = H*x_1;
y_2 = Perturbation (y_1, 0.2);

figure(1)
for j = 1:n
    subplot(3,3,j)
    plot(t_1, y_1(j,:), 'x', 'color', 'r', 'linewidth', 1.5)
    hold on
    plot(t_1, y_2(j,:), 'x', 'color', 'b', 'linewidth', 1.5)
    hold on
    grid on
    grid minor
    caption1 = sprintf('Experimental data');
    caption2 = sprintf('predicted values');
    caption3 = sprintf('Species %d', j);
    legend(caption1)%, caption2) 
    xlabel({'Time (min)'}, 'fontweight','bold', 'Fontsize', 11)
    ylabel(caption3, 'fontweight','bold', 'Fontsize', 12)
end
suptitle('Time-series experimental data for parameter estimation') 
